<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰‹æœ¯å™¨æ¢°ç›‘æµ‹ç³»ç»Ÿï¼ˆä¿®å¤ç™»å½•é—®é¢˜ï¼‰</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    /* å…¨å±€æ ·å¼ä¿æŒä¸å˜ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Microsoft YaHei', Arial, sans-serif;
    }

    body {
      background-color: #e6f7ff;
      color: #333;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }

    .loader-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #e6f7ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    .loader {
      width: 60px;
      height: 60px;
      border: 5px solid #b3e0ff;
      border-top: 5px solid #1890ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loader-text {
      font-size: 18px;
      color: #1890ff;
    }

    .network-error {
      color: #ff4d4f;
      font-size: 16px;
      margin-top: 10px;
      display: none;
    }

    .network-error.show {
      display: block;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 30px;
      display: none;
    }

    .container.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1, h2, h3 {
      color: #1890ff;
      margin-bottom: 25px;
      font-weight: 600;
    }

    h1 {
      font-size: 28px;
      text-align: center;
      margin: 30px 0;
    }

    h2 {
      font-size: 24px;
      border-bottom: 2px solid #e8f4f8;
      padding-bottom: 10px;
    }

    h3 {
      font-size: 20px;
      margin: 30px 0 15px;
    }

    button {
      background-color: #1890ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background-color: #096dd9;
    }

    button:disabled {
      background-color: #a0aec0;
      cursor: not-allowed;
    }

    .btn-block {
      width: 100%;
      margin-right: 0;
      padding: 12px;
      font-size: 17px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input[type="text"],
    input[type="password"],
    input[type="tel"],
    input[type="number"],
    input[type="email"],
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      font-size: 16px;
      transition: border 0.2s ease;
    }

    input:focus {
      outline: none;
      border-color: #1890ff;
    }

    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 10px;
      vertical-align: middle;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .modal-overlay.active,
    .modal-overlay.native-show {
      display: flex !important;
    }

    .modal {
      background-color: white;
      width: 90%;
      max-width: 500px;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      padding: 30px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 15px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #1890ff;
    }

    .close-btn {
      background: none;
      color: #999;
      font-size: 20px;
      cursor: pointer;
      border: none;
      margin: 0;
      padding: 0;
    }

    .close-btn:hover {
      background: none;
      color: #ff4d4f;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }

    .tab.active {
      border-bottom-color: #1890ff;
      color: #1890ff;
    }

    .agreement-container {
      height: 350px;
      overflow-y: auto;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      padding: 20px;
      margin: 20px 0;
      background-color: #f8f9fa;
      line-height: 1.8;
    }

    .agreement-container p {
      margin-bottom: 15px;
      text-align: justify;
    }

    .agreement-container strong {
      color: #1890ff;
    }

    .agreement-checkbox {
      margin: 20px 0;
      font-size: 16px;
    }

    .session-list {
      margin: 20px 0;
    }

    .session-item {
      padding: 15px;
      border: 1px solid #e8f4f8;
      border-radius: 4px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .session-info {
      flex: 1;
    }

    .session-meta {
      color: #666;
      font-size: 14px;
      margin-top: 5px;
    }

    .video-container {
      border: 1px solid #d9d9d9;
      width: 100%;
      height: 450px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      cursor: pointer;
      position: relative;
      z-index: 10;
    }

    .video-container:hover {
      background-color: #f0f7ff;
    }

    .video-status {
      text-align: center;
      padding: 0 20px;
    }

    .loading-indicator {
      width: 40px;
      height: 40px;
      border: 4px solid #b3e0ff;
      border-top: 4px solid #1890ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
      display: none;
    }

    .loading-indicator.active {
      display: block;
    }

    .control-bar {
      margin: 20px 0;
    }

    .safety-status {
      margin: 15px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .warning-list {
      margin: 15px 0;
    }

    .warning-item {
      padding: 12px;
      border-left: 3px solid #faad14;
      background-color: #fffbe6;
      margin-bottom: 10px;
      border-radius: 0 4px 4px 0;
    }

    .warning-item.red {
      border-left-color: #ff4d4f;
      background-color: #fff2f0;
    }

    .warning-header {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .warning-time {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .report-summary {
      background-color: #f0f8fb;
      padding: 20px;
      border-radius: 4px;
      margin: 20px 0;
    }

    .report-summary p {
      margin-bottom: 10px;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e8f4f8;
    }

    th {
      background-color: #f0f8fb;
      font-weight: 600;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
      background-color: #f8f9fa;
      border-radius: 4px;
      margin: 20px 0;
    }

    .file-upload-area {
      border: 2px dashed #1890ff;
      border-radius: 6px;
      padding: 30px;
      text-align: center;
      margin: 20px 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-upload-area:hover {
      background-color: #f0f7ff;
    }

    .file-upload-icon {
      font-size: 40px;
      color: #1890ff;
      margin-bottom: 15px;
    }

    .action-modal .modal {
      max-width: 400px;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .action-buttons button {
      flex: 1;
      padding: 12px;
    }

    #nativeVideoPlayer {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: none;
    }

    #nativeVideoPlayer.native-active {
      display: block !important;
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 24px;
      }

      h2 {
        font-size: 20px;
      }

      .video-container {
        height: 300px;
      }

      .agreement-container {
        height: 250px;
      }

      .session-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .session-item button {
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="loader-container" id="loader">
    <div class="loader"></div>
    <div class="loader-text">ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·è€å¿ƒç­‰å€™...</div>
    <div class="network-error" id="networkError">ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</div>
  </div>

  <div id="app" class="container">
    <!-- åˆ†æå·¥ä½œå° -->
    <div v-if="currentView === 'analysisWorkspace'">
      <h2>åˆ†æå·¥ä½œå° - {{ currentSession.name }}</h2>

      <div class="control-bar">
        <button onclick="nativeTogglePlay()">
          <span id="playText">æ’­æ”¾</span>
        </button>
        <button onclick="nativeStopPlay()" id="stopBtn" disabled>åœæ­¢</button>
        <button onclick="nativeToggleRecording()" id="recordBtn" disabled>
          <span id="recordText">å¼€å§‹å½•åˆ¶</span>
        </button>
        <button onclick="nativeTakeScreenshot()" id="screenshotBtn" disabled>æˆªå›¾</button>
        <button onclick="nativeShowSourceModal()">é€‰æ‹©è§†é¢‘æ¥æº</button>
      </div>

      <div class="safety-status">
        å®‰å…¨çŠ¶æ€: <span :style="{ color: safetyLevel === 'green' ? 'green' : safetyLevel === 'yellow' ? 'orange' : 'red' }">
          {{ safetyText }}
        </span>
      </div>

      <div class="video-container" onclick="nativeShowSourceModal()">
        <div class="video-status" id="videoStatus">
          <div class="loading-indicator" id="loadingIndicator"></div>
          <div id="statusText">ç‚¹å‡»æ­¤å¤„é€‰æ‹©è§†é¢‘æ¥æº</div>
        </div>
        
        <video 
          id="nativeVideoPlayer" 
          controls
          onloadedmetadata="nativeOnVideoLoaded()"
          onerror="nativeHandleVideoError()"
        ></video>
      </div>

      <h3>å®æ—¶è¯†åˆ«ï¼ˆ8ç±»å™¨æ¢°ï¼‰</h3>
      <p>å·²è¯†åˆ«å™¨æ¢°ï¼š{{ recognizedInstruments.join(', ') || 'æš‚æ— è¯†åˆ«ç»“æœï¼Œç­‰å¾…è§†é¢‘æ’­æ”¾' }}</p>

      <h3>å®‰å…¨é¢„è­¦ ({{ activeWarnings.length }})</h3>
      <div v-if="activeWarnings.length === 0" class="empty-state">
        <p>ä¸€åˆ‡æ­£å¸¸ï¼Œæ— æ´»è·ƒé¢„è­¦</p>
      </div>
      <div class="warning-list">
        <div v-for="(warning, index) in activeWarnings" :key="index" class="warning-item" :class="warning.type">
          <div class="warning-header">{{ warning.title }}</div>
          <div>{{ warning.description }}</div>
          <div class="warning-time">{{ warning.timestamp }}</div>
          <button @click="resolveWarning(index)" style="margin-top: 8px;">æ ‡è®°ä¸ºå·²å¤„ç†</button>
        </div>
      </div>

      <h3>æˆªå›¾è®°å½•</h3>
      <p>å½“å‰æˆªå›¾æ•°é‡: <span id="screenshotCount">0</span> å¼ </p>
      
      <div style="margin: 20px 0;">
        <button @click="goToReport" :disabled="!isReady">ç”Ÿæˆå¤ç›˜æŠ¥å‘Š</button>
        <button @click="showExitModal = true">ç»“æŸä¼šè¯</button>
      </div>
    </div>

    <!-- ç™»å½•é¡µ -->
    <div v-if="currentView === 'auth'">
      <h1>æ‰‹æœ¯å™¨æ¢°ç›‘æµ‹ç³»ç»Ÿ</h1>
      <div style="text-align: center; margin: 50px 0;">
        <button class="btn-block" style="margin-bottom: 20px;" @click="showLoginModal = true">ç™»å½•ç³»ç»Ÿ</button>
        <button class="btn-block" @click="showRegisterModal = true">æ³¨å†Œè´¦å·</button>
      </div>
    </div>

    <!-- æ¬¢è¿é¡µ/åè®®é¡µ -->
    <div v-if="currentView === 'welcome'">
      <h1>æ¬¢è¿ä½¿ç”¨æ‰‹æœ¯å®¤å™¨æ¢°ç›‘æµ‹ç³»ç»Ÿ</h1>
      
      <div class="agreement-container" ref="agreementRef" @scroll="checkAgreementScroll">
        <p><strong>ä¸€ã€æ•°æ®éšç§ä¸å®‰å…¨æ‰¿è¯º</strong></p>
        <p>1.1 æœ¬ç³»ç»Ÿä¸¥æ ¼éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œé«˜åº¦é‡è§†ç”¨æˆ·æ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤ã€‚</p>
        <p>1.2 æ‰€æœ‰æ‰‹æœ¯è§†é¢‘ã€å™¨æ¢°è¯†åˆ«æ•°æ®ç­‰æ•æ„Ÿä¿¡æ¯å‡åœ¨æœ¬åœ°è®¾å¤‡å¤„ç†å’Œå­˜å‚¨ï¼Œä¸ä¼šä¸Šä¼ è‡³å¤–éƒ¨æœåŠ¡å™¨ã€‚</p>
        <p>1.3 ç³»ç»Ÿé‡‡ç”¨æœ¬åœ°åŠ å¯†å­˜å‚¨æŠ€æœ¯ï¼Œç¡®ä¿æ•°æ®ä»…æˆæƒäººå‘˜å¯è®¿é—®ã€‚</p>
        
        <p><strong>äºŒã€ç³»ç»Ÿä½¿ç”¨è§„èŒƒ</strong></p>
        <p>2.1 æœ¬ç³»ç»Ÿä»…é¢å‘å…·å¤‡ç›¸åº”æ‰§ä¸šèµ„æ ¼çš„åŒ»åŠ¡äººå‘˜ä½¿ç”¨ã€‚</p>
        <p>2.2 ç³»ç»ŸåŠŸèƒ½ä»…ä½œä¸ºè¾…åŠ©å†³ç­–å·¥å…·ï¼Œä¸èƒ½å®Œå…¨æ›¿ä»£åŒ»åŠ¡äººå‘˜çš„ä¸“ä¸šåˆ¤æ–­ã€‚</p>
        <p>2.3 ç”¨æˆ·éœ€å¯¹æ‰€æœ‰åŒ»ç–—è¡Œä¸ºå’Œå†³ç­–æ‰¿æ‹…æœ€ç»ˆè´£ä»»ã€‚</p>
      </div>

      <div class="agreement-checkbox">
        <label>
          <input type="checkbox" v-model="agreed" :disabled="!isAgreementScrolledToBottom"> æˆ‘å·²å®Œæ•´é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾
        </label>
      </div>

      <button class="btn-block" :disabled="!agreed" @click="goToSessionManager">
        åŒæ„å¹¶è¿›å…¥ç³»ç»Ÿ
      </button>
    </div>

    <!-- ä¼šè¯ç®¡ç†é¡µ -->
    <div v-if="currentView === 'sessionManager'">
      <h2>æ‰‹æœ¯å¤ç›˜åˆ†æå·¥ä½œå°</h2>
      <p>è¯·é€‰æ‹©ä¸€ä¸ªä¼šè¯å¼€å§‹å·¥ä½œï¼Œæˆ–åˆ›å»ºæ–°çš„åˆ†æä¼šè¯ã€‚</p>

      <div class="file-upload-area" @click="triggerFileSelect('general')">
        <div class="file-upload-icon">ğŸ“‚</div>
        <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
        <p style="color: #666; font-size: 14px; margin-top: 10px;">æ”¯æŒè§†é¢‘æ–‡ä»¶ã€åˆ†ææŠ¥å‘Šç­‰</p>
      </div>

      <div class="session-list">
        <div v-if="sessions.length === 0" class="empty-state">
          <p>æš‚æ— å†å²ä¼šè¯è®°å½•</p>
        </div>

        <div v-for="(session, index) in sessions" :key="index" class="session-item">
          <div class="session-info">
            <div>{{ session.name }}</div>
            <div class="session-meta">
              åˆ›å»ºæ—¶é—´: {{ session.date }} | åˆ†ææ—¶é•¿: {{ session.duration }} | é¢„è­¦æ¬¡æ•°: {{ session.warnings }}æ¬¡
            </div>
          </div>
          <button @click="openSession(index)">æ‰“å¼€</button>
        </div>
      </div>
    </div>

    <!-- æŠ¥å‘Šé¡µ -->
    <div v-if="currentView === 'reviewReport'">
      <h2>æ‰‹æœ¯å¤ç›˜åˆ†ææŠ¥å‘Š</h2>
      <div class="report-summary" ref="reportContent">
        <p>æ‰‹æœ¯åç§°: {{ currentSession.name }}</p>
        <p>åˆ†ææ—¶é•¿: {{ currentSession.duration }}</p>
        <p>è¯†åˆ«å™¨æ¢°ç§ç±»: {{ recognizedInstruments.length }}ç§ï¼ˆ{{ recognizedInstruments.join(', ') }}ï¼‰</p>
        <p>é¢„è­¦ç»Ÿè®¡: æ€»è®¡ {{ totalWarnings }}æ¬¡ï¼ˆçº¢è‰²é¢„è­¦: {{ redWarningCount }}æ¬¡ | é»„è‰²é¢„è­¦: {{ yellowWarningCount }}æ¬¡ï¼‰</p>
        <p>æˆªå›¾æ•°é‡: {{ screenshots.length }}å¼ </p>
      </div>

      <h3>é¢„è­¦ç±»å‹åˆ†å¸ƒ</h3>
      <div class="empty-state">
        <p>é¢„è­¦åˆ†å¸ƒç»Ÿè®¡å›¾è¡¨</p>
        <p>çº¢è‰²é¢„è­¦: {{ redWarningCount }}æ¬¡ | é»„è‰²é¢„è­¦: {{ yellowWarningCount }}æ¬¡</p>
      </div>

      <h3>è¯†åˆ«å‡†ç¡®ç‡è¶‹åŠ¿</h3>
      <div class="empty-state">
        <p>è¯†åˆ«å‡†ç¡®ç‡ç»Ÿè®¡å›¾è¡¨</p>
      </div>

      <h3>è¯¦ç»†äº‹ä»¶åˆ—è¡¨</h3>
      <table ref="eventTable">
        <thead>
          <tr>
            <th>æ—¶é—´ç‚¹</th>
            <th>äº‹ä»¶ç±»å‹</th>
            <th>è¯¦ç»†ä¿¡æ¯</th>
            <th>å…³è”æˆªå›¾</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(event, index) in eventList" :key="index">
            <td>{{ event.time }}</td>
            <td>{{ event.type }}</td>
            <td>{{ event.details }}</td>
            <td>{{ event.hasScreenshot ? 'æœ‰' : 'æ— ' }}</td>
          </tr>
        </tbody>
      </table>

      <div style="margin: 30px 0; text-align: right;">
        <button @click="exportPDF">å¯¼å‡ºPDFæŠ¥å‘Š</button>
        <button @click="exportCSV">å¯¼å‡ºCSVæ•°æ®</button>
        <button @click="printReport">æ‰“å°æŠ¥å‘Š</button>
        <button @click="currentView = 'sessionManager'">è¿”å›ä¼šè¯ç®¡ç†</button>
      </div>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal-overlay" :class="{ active: showLoginModal }" @click.self="showLoginModal = false">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ç”¨æˆ·ç™»å½•</div>
          <button class="close-btn" @click="showLoginModal = false">Ã—</button>
        </div>
        
        <div class="tabs">
          <div class="tab" :class="{ active: loginTab === 'password' }" @click="loginTab = 'password'">
            è´¦å·å¯†ç ç™»å½•
          </div>
          <div class="tab" :class="{ active: loginTab === 'verify' }" @click="loginTab = 'verify'">
            éªŒè¯ç ç™»å½•
          </div>
        </div>
        
        <div class="login-content">
          <div v-if="loginTab === 'password'">
            <div class="form-group">
              <label>ç™»å½•è´¦å·</label>
              <input type="text" v-model="loginForm.username" placeholder="è¯·è¾“å…¥æ‚¨çš„ç™»å½•è´¦å·">
            </div>
            <div class="form-group">
              <label>ç™»å½•å¯†ç </label>
              <input type="password" v-model="loginForm.password" placeholder="è¯·è¾“å…¥æ‚¨çš„ç™»å½•å¯†ç ">
            </div>
            <button class="btn-block" @click="handlePasswordLogin">ç™»å½•</button>
          </div>

          <div v-if="loginTab === 'verify'">
            <div class="form-group">
              <label>æ‰‹æœºå·ç </label>
              <input type="tel" v-model="verifyForm.phone" placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ç ">
            </div>
            <div class="form-group" style="display: flex; gap: 10px;">
              <div style="flex: 1;">
                <label>éªŒè¯ç </label>
                <input type="text" v-model="verifyForm.code" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
              </div>
              <div style="display: flex; align-items: flex-end;">
                <button :disabled="countDown > 0" @click="getVerifyCode" style="height: 44px;">
                  {{ countDown > 0 ? `${countDown}ç§’åé‡æ–°è·å–` : 'è·å–éªŒè¯ç ' }}
                </button>
              </div>
            </div>
            <button class="btn-block" @click="handleVerifyLogin">ç™»å½•</button>
          </div>
        </div>
      </div>
    </div>

    <!-- æ³¨å†Œå¼¹çª— -->
    <div class="modal-overlay" :class="{ active: showRegisterModal }" @click.self="showRegisterModal = false">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ç”¨æˆ·æ³¨å†Œ</div>
          <button class="close-btn" @click="showRegisterModal = false">Ã—</button>
        </div>
        
        <div class="register-content">
          <div class="form-group">
            <label>çœŸå®å§“å</label>
            <input type="text" v-model="registerForm.name" placeholder="è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å">
          </div>
          <div class="form-group">
            <label>æ‰‹æœºå·ç </label>
            <input type="tel" v-model="registerForm.phone" placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ç ">
          </div>
          <div class="form-group">
            <label>éªŒè¯ç </label>
            <div style="display: flex; gap: 10px;">
              <input type="text" v-model="registerForm.code" placeholder="è¯·è¾“å…¥éªŒè¯ç " style="flex: 1;">
              <button :disabled="regCountDown > 0" @click="getRegVerifyCode" style="height: 44px;">
                {{ regCountDown > 0 ? `${regCountDown}ç§’åé‡æ–°è·å–` : 'è·å–éªŒè¯ç ' }}
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>ç™»å½•è´¦å·</label>
            <input type="text" v-model="registerForm.username" placeholder="è¯·è®¾ç½®ç™»å½•è´¦å·">
          </div>
          <div class="form-group">
            <label>ç™»å½•å¯†ç </label>
            <input type="password" v-model="registerForm.password" placeholder="è¯·è®¾ç½®ç™»å½•å¯†ç ï¼ˆä¸å°‘äº8ä½ï¼‰">
          </div>
          <div class="form-group">
            <label>ç¡®è®¤å¯†ç </label>
            <input type="password" v-model="registerForm.confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
          </div>
          
          <button class="btn-block" @click="handleRegister">æäº¤æ³¨å†Œ</button>
        </div>
      </div>
    </div>

    <!-- ç»“æŸä¼šè¯å¼¹çª— -->
    <div class="modal-overlay" :class="{ active: showExitModal }" @click.self="showExitModal = false">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ç»“æŸå½“å‰ä¼šè¯</div>
          <button class="close-btn" @click="showExitModal = false">Ã—</button>
        </div>
        
        <div style="margin: 20px 0;">
          <p>è¯·é€‰æ‹©å¦‚ä½•å¤„ç†æœ¬æ¬¡åˆ†ææ•°æ®ï¼š</p>
          
          <div style="margin: 20px 0;">
            <label style="display: block; margin-bottom: 15px;">
              <input type="radio" name="exitOption" value="save" checked> ä¿å­˜å®Œæ•´æŠ¥å‘Š
            </label>
            <label style="display: block; margin-bottom: 15px;">
              <input type="radio" name="exitOption" value="draft"> ä¿å­˜ä¸ºè‰ç¨¿
            </label>
            <label style="display: block;">
              <input type="radio" name="exitOption" value="discard"> æ”¾å¼ƒæœ¬æ¬¡ä¼šè¯
            </label>
          </div>
          
          <div style="text-align: right;">
            <button @click="showExitModal = false">å–æ¶ˆ</button>
            <button @click="handleExit">ç¡®è®¤</button>
          </div>
        </div>
      </div>
    </div>

    <!-- è§†é¢‘æ¥æºé€‰æ‹©å¼¹çª— -->
    <div class="modal-overlay action-modal" id="sourceModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">é€‰æ‹©è§†é¢‘æ¥æº</div>
          <button class="close-btn" onclick="nativeHideSourceModal()">Ã—</button>
        </div>
        
        <div>
          <p>è¯·é€‰æ‹©è§†é¢‘æ¥æºæ–¹å¼å¼€å§‹åˆ†æï¼š</p>
          
          <div class="action-buttons">
            <button onclick="nativeHandleUpload()">A. ä¸Šä¼ è§†é¢‘</button>
            <button onclick="nativeHandleCamera()">B. å¼€å¯æ‘„åƒå¤´</button>
          </div>
        </div>
      </div>
    </div>

    <!-- éšè—çš„æ–‡ä»¶é€‰æ‹©å™¨ -->
    <input type="file" id="nativeFileInput" style="display: none" accept=".mp4,.avi,.mov,.mkv" onchange="nativeHandleFileSelected(event)">
    <input type="file" id="generalFileInput" ref="generalFileInput" style="display: none" accept=".mp4,.avi,.pdf,.csv" multiple @change="handleGeneralFileSelected">
  </div>

  <script>
    window.onload = function() {
      setTimeout(() => {
        document.getElementById('loader').style.opacity = 0;
        setTimeout(() => {
          document.getElementById('loader').style.display = 'none';
          document.getElementById('app').classList.add('active');
        }, 500);
      }, 1000);
    };

    const app = new Vue({
      el: '#app',
      data() {
        return {
          currentView: 'auth',
          showLoginModal: false,
          showRegisterModal: false,
          loginTab: 'password',
          loginForm: { username: '', password: '' },
          verifyForm: { phone: '', code: '' },
          registerForm: {
            name: '', phone: '', code: '', 
            username: '', password: '', confirmPassword: ''
          },
          countDown: 0,
          regCountDown: 0,
          agreed: false,
          isAgreementScrolledToBottom: false,
          sessions: [
            { name: 'è…¹è…”é•œèƒ†å›Šåˆ‡é™¤æœ¯', date: '2025-11-20 09:30', duration: '45åˆ†é’Ÿ', warnings: 3 },
            { name: 'è†å…³èŠ‚ç½®æ¢æœ¯', date: '2025-11-18 14:15', duration: '90åˆ†é’Ÿ', warnings: 5 }
          ],
          currentSession: null,
          showExitModal: false,
          safetyLevel: 'green',
          recognizedInstruments: ['æ‰‹æœ¯åˆ€', 'æ­¢è¡€é’³', 'ç¼åˆé’ˆ'],
          activeWarnings: [
            { 
              title: 'å™¨æ¢°æœªæ­£ç¡®æ¶ˆæ¯’', 
              description: 'æ£€æµ‹åˆ°æ­¢è¡€é’³æ¶ˆæ¯’æ—¶é—´ä¸è¶³ï¼Œå»ºè®®é‡æ–°æ¶ˆæ¯’', 
              timestamp: '10:23:45', 
              type: 'yellow' 
            }
          ],
          screenshots: [],
          eventList: [
            { time: '10:15:30', type: 'å™¨æ¢°è¯†åˆ«', details: 'è¯†åˆ«åˆ°æ‰‹æœ¯åˆ€', hasScreenshot: false },
            { time: '10:23:45', type: 'é»„è‰²é¢„è­¦', details: 'æ­¢è¡€é’³æ¶ˆæ¯’æ—¶é—´ä¸è¶³', hasScreenshot: true }
          ],
          isReady: false
        };
      },
      computed: {
        safetyText() {
          switch(this.safetyLevel) {
            case 'green': return 'ä¸€åˆ‡æ­£å¸¸';
            case 'yellow': return 'æ³¨æ„ï¼šå­˜åœ¨æ½œåœ¨é£é™©';
            case 'red': return 'è­¦å‘Šï¼šå­˜åœ¨ä¸¥é‡å®‰å…¨éšæ‚£';
            default: return 'æœªçŸ¥çŠ¶æ€';
          }
        },
        totalWarnings() {
          return this.activeWarnings.length;
        },
        redWarningCount() {
          return this.activeWarnings.filter(w => w.type === 'red').length;
        },
        yellowWarningCount() {
          return this.activeWarnings.filter(w => w.type === 'yellow').length;
        }
      },
      methods: {
        // ç™»å½•ç›¸å…³æ–¹æ³•ï¼ˆå•ç‹¬æå–ï¼Œç¡®ä¿äº‹ä»¶ç»‘å®šæ­£ç¡®ï¼‰
        handlePasswordLogin() {
          if (!this.loginForm.username || !this.loginForm.password) {
            alert('è¯·è¾“å…¥è´¦å·å’Œå¯†ç ');
            return;
          }
          alert('ç™»å½•æˆåŠŸ');
          this.showLoginModal = false;
          this.currentView = 'welcome';
        },
        handleVerifyLogin() {
          if (!this.verifyForm.phone || !this.verifyForm.code) {
            alert('è¯·è¾“å…¥æ‰‹æœºå·ç å’ŒéªŒè¯ç ');
            return;
          }
          alert('ç™»å½•æˆåŠŸ');
          this.showLoginModal = false;
          this.currentView = 'welcome';
        },
        handleRegister() {
          if (!this.registerForm.name || !this.registerForm.phone || !this.registerForm.code ||
              !this.registerForm.username || !this.registerForm.password || !this.registerForm.confirmPassword) {
            alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
            return;
          }
          if (this.registerForm.password !== this.registerForm.confirmPassword) {
            alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
            return;
          }
          if (this.registerForm.password.length < 8) {
            alert('å¯†ç é•¿åº¦ä¸å°‘äº8ä½');
            return;
          }
          alert('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
          this.showRegisterModal = false;
          this.showLoginModal = true;
        },

        // å…¶ä»–åŸæœ‰æ–¹æ³•
        checkAgreementScroll() {
          const element = this.$refs.agreementRef;
          this.isAgreementScrolledToBottom = 
            Math.ceil(element.scrollTop + element.clientHeight) >= element.scrollHeight;
        },
        goToSessionManager() {
          this.currentView = 'sessionManager';
        },
        openSession(index) {
          this.currentSession = this.sessions[index];
          this.currentView = 'analysisWorkspace';
          // é‡ç½®è§†é¢‘çŠ¶æ€
          document.getElementById('nativeVideoPlayer').classList.remove('native-active');
          document.getElementById('statusText').textContent = 'ç‚¹å‡»æ­¤å¤„é€‰æ‹©è§†é¢‘æ¥æº';
          document.getElementById('loadingIndicator').classList.remove('active');
          document.getElementById('playText').textContent = 'æ’­æ”¾';
          document.getElementById('stopBtn').disabled = true;
          document.getElementById('recordBtn').disabled = true;
          document.getElementById('screenshotBtn').disabled = true;
          document.getElementById('screenshotCount').textContent = '0';
          this.isReady = false;
          this.screenshots = [];
        },
        triggerFileSelect(type) {
          if (type === 'general') {
            this.$refs.generalFileInput.click();
          }
        },
        handleGeneralFileSelected(event) {
          const files = event.target.files;
          if (files.length > 0) {
            alert(`å·²ä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶`);
          }
        },
        resolveWarning(index) {
          this.activeWarnings.splice(index, 1);
        },
        goToReport() {
          this.currentView = 'reviewReport';
        },
        handleExit() {
          const exitOption = document.querySelector('input[name="exitOption"]:checked').value;
          if (exitOption === 'save') alert('ä¼šè¯å·²ä¿å­˜ä¸ºå®Œæ•´æŠ¥å‘Š');
          else if (exitOption === 'draft') alert('ä¼šè¯å·²ä¿å­˜ä¸ºè‰ç¨¿');
          else alert('å·²æ”¾å¼ƒæœ¬æ¬¡ä¼šè¯');
          this.showExitModal = false;
          this.currentView = 'sessionManager';
        },
        exportPDF() {
          alert('PDFå¯¼å‡ºåŠŸèƒ½å·²è§¦å‘');
        },
        exportCSV() {
          alert('CSVå¯¼å‡ºåŠŸèƒ½å·²è§¦å‘');
        },
        printReport() {
          window.print();
        },
        getVerifyCode() {
          if (!this.verifyForm.phone) {
            alert('è¯·è¾“å…¥æ‰‹æœºå·ç ');
            return;
          }
          this.countDown = 60;
          const timer = setInterval(() => {
            this.countDown--;
            if (this.countDown <= 0) clearInterval(timer);
          }, 1000);
          alert('éªŒè¯ç å·²å‘é€');
        },
        getRegVerifyCode() {
          if (!this.registerForm.phone) {
            alert('è¯·è¾“å…¥æ‰‹æœºå·ç ');
            return;
          }
          this.regCountDown = 60;
          const timer = setInterval(() => {
            this.regCountDown--;
            if (this.regCountDown <= 0) clearInterval(timer);
          }, 1000);
          alert('éªŒè¯ç å·²å‘é€');
        }
      }
    });

    // æš´éœ²Vueå®ä¾‹åˆ°å…¨å±€
    window.vueApp = app;

    // åŸç”Ÿè§†é¢‘æ§åˆ¶é€»è¾‘
    let isNativePlaying = false;
    let isNativeRecording = false;
    let nativeScreenshotCount = 0;
    let mediaStream = null;

    function nativeShowSourceModal() {
      const modal = document.getElementById('sourceModal');
      modal.classList.add('native-show');
    }

    function nativeHideSourceModal() {
      const modal = document.getElementById('sourceModal');
      modal.classList.remove('native-show');
    }

    function nativeHandleUpload() {
      nativeHideSourceModal();
      document.getElementById('loadingIndicator').classList.add('active');
      document.getElementById('statusText').textContent = 'æ­£åœ¨åŠ è½½è§†é¢‘...';
      document.getElementById('nativeFileInput').click();
    }

    function nativeHandleCamera() {
      nativeHideSourceModal();
      document.getElementById('loadingIndicator').classList.add('active');
      document.getElementById('statusText').textContent = 'æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´...';
      document.getElementById('nativeVideoPlayer').classList.remove('native-active');

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          mediaStream = stream;
          const video = document.getElementById('nativeVideoPlayer');
          video.srcObject = stream;
          video.load();
          video.play().then(() => {
            document.getElementById('loadingIndicator').classList.remove('active');
            document.getElementById('nativeVideoPlayer').classList.add('native-active');
            document.getElementById('statusText').textContent = 'æ‘„åƒå¤´å®æ—¶åˆ†æä¸­';
            isNativePlaying = true;
            document.getElementById('playText').textContent = 'æš‚åœ';
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('recordBtn').disabled = false;
            document.getElementById('screenshotBtn').disabled = false;
            window.vueApp.isReady = true;
          }).catch(err => {
            console.error('æ‘„åƒå¤´æ’­æ”¾å¤±è´¥:', err);
            document.getElementById('loadingIndicator').classList.remove('active');
            document.getElementById('statusText').textContent = 'æ‘„åƒå¤´æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•';
            alert('æ‘„åƒå¤´æ’­æ”¾å¤±è´¥: ' + err.message);
          });
        })
        .catch(err => {
          console.error('æ‘„åƒå¤´è®¿é—®å¤±è´¥:', err);
          document.getElementById('loadingIndicator').classList.remove('active');
          document.getElementById('statusText').textContent = 'æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™';
          alert('æ— æ³•è®¿é—®æ‘„åƒå¤´: ' + err.message);
        });
    }

    function nativeHandleFileSelected(event) {
      const files = event.target.files;
      if (!files || files.length === 0) {
        document.getElementById('loadingIndicator').classList.remove('active');
        document.getElementById('statusText').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
        return;
      }

      const videoFile = files[0];
      const validTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/mkv'];
      if (!validTypes.includes(videoFile.type)) {
        document.getElementById('loadingIndicator').classList.remove('active');
        document.getElementById('statusText').textContent = 'ä¸æ”¯æŒçš„è§†é¢‘æ ¼å¼';
        alert('ä¸æ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼Œè¯·ä¸Šä¼ MP4ã€AVIã€MOVæˆ–MKVæ ¼å¼');
        return;
      }

      const videoURL = URL.createObjectURL(videoFile);
      const video = document.getElementById('nativeVideoPlayer');
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
        mediaStream = null;
      }
      video.src = videoURL;
      video.load();
      video.play().then(() => {
        document.getElementById('loadingIndicator').classList.remove('active');
        document.getElementById('nativeVideoPlayer').classList.add('native-active');
        document.getElementById('statusText').textContent = 'æ­£åœ¨åˆ†æï¼š' + videoFile.name;
        isNativePlaying = true;
        document.getElementById('playText').textContent = 'æš‚åœ';
        document.getElementById('stopBtn').disabled = false;
        document.getElementById('recordBtn').disabled = false;
        document.getElementById('screenshotBtn').disabled = false;
        window.vueApp.isReady = true;
      }).catch(err => {
        console.error('è§†é¢‘æ’­æ”¾å¤±è´¥:', err);
        document.getElementById('loadingIndicator').classList.remove('active');
        document.getElementById('nativeVideoPlayer').classList.add('native-active');
        document.getElementById('statusText').textContent = 'è§†é¢‘å·²åŠ è½½ï¼Œè¯·æ‰‹åŠ¨æ’­æ”¾';
        window.vueApp.isReady = true;
        alert('è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œè¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ‰‹åŠ¨æ’­æ”¾');
      });
    }

    function nativeOnVideoLoaded() {
      console.log('è§†é¢‘åŠ è½½å®Œæˆ');
    }

    function nativeHandleVideoError() {
      document.getElementById('loadingIndicator').classList.remove('active');
      document.getElementById('nativeVideoPlayer').classList.remove('native-active');
      document.getElementById('statusText').textContent = 'è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ ';
      alert('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§');
      window.vueApp.isReady = false;
    }

    function nativeTogglePlay() {
      const video = document.getElementById('nativeVideoPlayer');
      if (!video) return;

      if (isNativePlaying) {
        video.pause();
        document.getElementById('playText').textContent = 'æ’­æ”¾';
      } else {
        video.play().catch(err => {
          console.error('æ’­æ”¾å¤±è´¥:', err);
          alert('æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•');
          return;
        });
        document.getElementById('playText').textContent = 'æš‚åœ';
      }
      isNativePlaying = !isNativePlaying;
    }

    function nativeStopPlay() {
      const video = document.getElementById('nativeVideoPlayer');
      if (!video) return;

      video.pause();
      video.currentTime = 0;
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
        mediaStream = null;
      }
      isNativePlaying = false;
      isNativeRecording = false;
      document.getElementById('playText').textContent = 'æ’­æ”¾';
      document.getElementById('recordText').textContent = 'å¼€å§‹å½•åˆ¶';
      document.getElementById('stopBtn').disabled = true;
      document.getElementById('recordBtn').disabled = true;
      document.getElementById('screenshotBtn').disabled = true;
      document.getElementById('nativeVideoPlayer').classList.remove('native-active');
      document.getElementById('statusText').textContent = 'ç‚¹å‡»æ­¤å¤„é€‰æ‹©è§†é¢‘æ¥æº';
      window.vueApp.isReady = false;
    }

    function nativeToggleRecording() {
      if (isNativeRecording) {
        document.getElementById('recordText').textContent = 'å¼€å§‹å½•åˆ¶';
        alert('å½•åˆ¶å·²åœæ­¢');
      } else {
        document.getElementById('recordText').textContent = 'åœæ­¢å½•åˆ¶';
        alert('å½•åˆ¶å·²å¼€å§‹');
      }
      isNativeRecording = !isNativeRecording;
    }

    function nativeTakeScreenshot() {
      nativeScreenshotCount++;
      document.getElementById('screenshotCount').textContent = nativeScreenshotCount;
      const now = new Date();
      const timestamp = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      window.vueApp.screenshots.push({ timestamp });
      alert(`å·²æˆªå›¾ï¼Œå½“å‰å…± ${nativeScreenshotCount} å¼ `);
    }



    // äº‹ä»¶ç©¿é€é˜²æŠ¤
    document.querySelector('.video-container').addEventListener('click', function(e) {
      e.stopPropagation();
    });

    document.querySelectorAll('.close-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
      });
    });

    // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
    window.addEventListener('beforeunload',function(){
      if(mediaStream){
        mediaStream.getTracks().forEach(track=>track.stop());
      }
      const video=document.getElementByld('nativaVideoPlayer');
      if(video.srcObject){
        video.srcObject=null;
      }
      if(video.src){
        URL.revokeObjectURL(video.src);
        video.src=' '
      }
    });
    
  </script>
</body>
</html>